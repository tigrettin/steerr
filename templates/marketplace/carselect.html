{% extends "base.html" %}
{% load humanize %}

{% block title %}Marketplace | STEERR{% endblock %}
{% block marketplace_active %}active{% endblock %}

{% block body %}

<div class="container-fluid">

	{% if not user.is_authenticated %}
		{% if years %}
			<a href="{% url 'home:register' %}" class="btn btn-primary btn-lg"><strong>Register</strong> to sell your car!</a><br>
		{% else %}
			{% if make %}
				<p><strong>Make:</strong> {{ make }}</p>
			{% endif %}

			{% if model %}
				<p><strong>Model:</strong> {{ model }}</p>
			{% endif %}

			{% if platform %}
				<p><strong>Platform:</strong> {{ platform }}</p>
			{% endif %}

			{% if body %}
				<p><strong>Body:</strong> {{ body }}</p>
			{% endif %}

			{% if version %}
				<p><strong>Version:</strong> {{ version }}</p>
			{% endif %}
		{% endif %}
	{% else %}
		{% if years %}
			<a href="{% url 'new-listing' make=make years=years %}" class="btn btn-primary">Sell your car!</a>
		{% else %}
			<p class="alert alert-info fade in">
				<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
				Before <strong>selling your car</strong>, please select:
			</p> 
			{% if make %}
				<p><strong>Make:</strong> {{ make }}</p>
			{% endif %}

			{% if model %}
				<p><strong>Model:</strong> {{ model }}</p>
			{% endif %}

			{% if platform %}
				<p><strong>Platform:</strong> {{ platform }}</p>
			{% endif %}

			{% if body %}
				<p><strong>Body:</strong> {{ body }}</p>
			{% endif %}

			{% if version %}
				<p><strong>Version:</strong> {{ version }}</p>
			{% endif %}
		{% endif %}
	{% endif %}

	{% if years %}		
	{% else %}
		<form action="" method="GET">
		    <input type="hidden" name="submitted" value="1" />
		    {{ form.as_p }}
		    <input type="submit" class="btn btn-default" value="Select" />
		</form>
	{% endif %}

	<h2>Latest Listings
	{% if years %} for <a href="{% url 'car' make=make years=years %}">{{ make }} {{ years }}</a>
	{% elif version %} for <a href="{% url 'reviews:years-select' make=make model=model platform=platform body=body version=version %}">{{ make }} {{ version }}</a>
	{% elif body %} for <a href="{% url 'reviews:version-select' make=make model=model platform=platform body=body %}">{{ make }} {{ body }}</a>
	{% elif platform %} for <a href="{% url 'reviews:body-select' make=make model=model platform=platform %}">{{ make }} {{ platform }}</a>
	{% elif model %} for <a href="{% url 'reviews:platform-select' make=make model=model %}">{{ make }} {{ model }}</a>
	{% elif make %} for <a href="{% url 'reviews:model-select' make %}">{{ make }}{% endif %}</a></h2>

	{% if not listings %}
		<div class="listing"><p><i>There are no listings for this car yet.</i></p></div>
	{% endif %}

	{% for listing in listings %}
		<div class="listing">
			@<a href="{% url 'home:member' listing.user.username %}">{{ listing.user }}</a> ({{ listing.created.date }})<br>
			<h4><a href="{% url 'car-listing' make=listing.car.make years=listing.car.years listing_id=listing.id %}">{{ listing.title }}</a></h4>
			<p><kbd>{{ listing.year }} {{ listing.car.make }} {{ listing.car.version }}</kbd> {{ listing.mileage }} km, ${{ listing.price|intcomma }}</p>
			<p></p>
		</div>
	{% endfor %}

</div>

{% endblock %}